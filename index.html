<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vocab Trainer — Revamped</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .modal-bg { background: rgba(0,0,0,0.55); }
  .pop { animation: pop .25s ease-out; }
  @keyframes pop { from { transform: scale(.9); opacity: 0;} to {transform: scale(1); opacity:1;} }
</style>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="max-w-5xl mx-auto p-6">
    <header class="mb-6">
      <h1 class="text-4xl font-bold mb-2">Vocab Trainer</h1>
      <p class="text-gray-600">Revamped clean UI • Pop‑out quiz • Progress tracking</p>
    </header>

    <section class="flex gap-3 mb-4 items-center">
      <input id="search" class="border p-2 rounded flex-1" placeholder="Search words..." />
      <select id="posFilter" class="border p-2 rounded"><option value="">All POS</option></select>
      <button id="triggerQuiz" class="bg-blue-600 text-white px-4 py-2 rounded">Start Quiz</button>
      <div class="text-sm">Score: <strong id="score">0/0</strong></div>
      <button id="reset" class="text-sm underline ml-auto">Reset</button>
    </section>

    <div class="border rounded bg-white p-3 max-h-[70vh] overflow-auto" id="wordList"></div>
  </div>

  <!-- Quiz Modal -->
  <div id="quizModal" class="fixed inset-0 hidden modal-bg flex items-center justify-center p-4">
    <div class="bg-white rounded-xl shadow-xl max-w-lg w-full p-6 pop">
      <h2 class="text-xl font-bold mb-3">Quiz</h2>
      <div id="blank" class="text-lg mb-4 font-medium"></div>
      <div id="options" class="grid gap-2"></div>
      <div id="result" class="mt-4 text-lg"></div>
      <div class="flex justify-end mt-6 gap-2">
        <button id="nextQuiz" class="bg-blue-600 text-white px-4 py-2 rounded">Next</button>
        <button id="closeQuiz" class="border px-4 py-2 rounded">Close</button>
      </div>
    </div>
  </div>

<script>
// === LOAD DATA ===
let DATA = [];
fetch('sat_vocab_clean2.json').then(r=>r.json()).then(d=>{ DATA = d; init(); });

// === STATE ===
let words = [];
let known = JSON.parse(localStorage.getItem('known')||'{}');
let progress = JSON.parse(localStorage.getItem('prog')||'{"correct":0,"total":0}');
let quizWord = null;

// === SHORTCUTS ===
const $ = s => document.querySelector(s);

// === INIT ===
function init(){
  words = DATA.map((w,i)=>({_id:i, ...w}));
  populatePOS();
  renderList(words);
  $('#score').textContent = `${progress.correct}/${progress.total}`;

  $('#search').addEventListener('input',applyFilters);
  $('#posFilter').addEventListener('change',applyFilters);
  $('#triggerQuiz').addEventListener('click',startQuiz);
  $('#closeQuiz').addEventListener('click',()=>$('#quizModal').classList.add('hidden'));
  $('#nextQuiz').addEventListener('click',startQuiz);
  $('#reset').addEventListener('click',()=>{ if(confirm('Reset progress?')){known={};progress={correct:0,total:0};save();renderList(words);} });
}

function populatePOS(){
  const set = new Set(words.map(w=>w.pos));
  $('#posFilter').innerHTML = '<option value="">All POS</option>' + [...set].map(p=>`<option value="${p}">${p}</option>`).join('');
}

// === RENDER WORD LIST ===
function renderList(arr){
  const box = $('#wordList');
  box.innerHTML = '';
  arr.forEach(w=>{
    const row = document.createElement('div');
    row.className = 'p-3 border-b flex justify-between items-start hover:bg-gray-50';
    row.innerHTML = `
      <div>
        <div class='font-semibold text-lg'>${w.word}</div>
        <div class='text-sm italic text-gray-600'>${w.pos}</div>
        <div class='text-sm mt-1'>${w.definition}</div>
        <div class='text-xs text-gray-500 mt-1'>${w.sentence}</div>
      </div>
      <div class='text-right'>
        <label class='text-sm'>Known
          <input type='checkbox' ${known[w._id]?'checked':''} data-id='${w._id}' class='knownChk'>
        </label>
      </div>`;
    box.appendChild(row);
  });
  document.querySelectorAll('.knownChk').forEach(ch=>{
    ch.addEventListener('change',()=>{
      const id = ch.dataset.id;
      if(ch.checked) known[id]=true; else delete known[id];
      save();
    });
  });
}

// === FILTER ===
function applyFilters(){
  const q = $('#search').value.toLowerCase();
  const pos = $('#posFilter').value;
  const res = words.filter(w=>{
    if(pos && w.pos!==pos) return false;
    return w.word.toLowerCase().includes(q) || w.definition.toLowerCase().includes(q) || w.sentence.toLowerCase().includes(q);
  });
  renderList(res);
}

// === QUIZ ===
function startQuiz(){
  quizWord = words[Math.floor(Math.random()*words.length)];
  let blank = quizWord.sentence.replace(new RegExp(`\\b${quizWord.word}\\b`,'i'),'_____');
  $('#blank').textContent = blank;

  let opts = words.filter(w=>w.pos===quizWord.pos && w._id!==quizWord._id).slice(0,3).map(w=>w.word);
  while(opts.length<3) opts.push(words[Math.floor(Math.random()*words.length)].word);
  opts = [quizWord.word,...opts].sort(()=>Math.random()-0.5);

  $('#options').innerHTML = '';
  opts.forEach(o=>{
    const b=document.createElement('button');
    b.className='p-2 border rounded w-full text-left';
    b.textContent=o;
    b.onclick=()=>answer(o);
    $('#options').appendChild(b);
  });
  $('#result').textContent='';
  $('#quizModal').classList.remove('hidden');
}

function answer(o){
  progress.total++;
  if(o===quizWord.word){
    progress.correct++;
    $('#result').innerHTML = `<div class='text-green-600 font-semibold'>Correct!</div>`;
  } else {
    $('#result').innerHTML = `<div class='text-red-600 font-semibold'>Incorrect — ${quizWord.word}</div>`;
  }
  $('#score').textContent = `${progress.correct}/${progress.total}`;
  save();
}

function save(){
  localStorage.setItem('known',JSON.stringify(known));
  localStorage.setItem('prog',JSON.stringify(progress));
}
</script>
</body>
</html>
